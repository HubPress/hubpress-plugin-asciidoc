"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function splitMore(t){var e=t.split("pass::[more]");return{excerpt:e[0],full:e.join("")}}function convert(t,e){var s=opal.hash({doctype:"article",backend:"html5",safe:"unsafe",attributes:["showtitle!","allow-uri-read","imagesdir="+t.urls.site+"/images","icons=font"]}),o=/gist::([0-9]*)\[(lines=[0-9]*\.\.[0-9]*)?,?(type=([\w.]*))?,?(file=([\w.]*))?\]/g,i=e.replace(o,"[source,$4]\n----\ninclude::https://gist.githubusercontent.com/raw/$1/$6[$2]\n----\n"),r=splitMore(i),a=processor.$load(r.excerpt,s),n=processor.$load(r.full,s),u={attributes:_lodash2["default"].pick(n.attributes,["$$smap"]),excerpt:a.$convert(),html:n.$convert()};return u}function extractTags(t){var e="hp-tags";return t.$$smap[e]&&t.$$smap[e].split(",").filter(function(t){return""!==t.trim()})}function asciidocPlugin(t){t.on("hubpress:request-rendering-documents",function(t){console.info("Asciidoc Plugin - hubpress:request-rendering-documents"),console.log("hubpress:request-rendering-documents",t);var e=t.rootState.application.config,s=(t.nextState.posts||[]).map(function(t){var s=Object.assign({},t,convert(e,t.content),{content:t.content}),o=_lodash2["default"].pick(s,"attributes","author","html","tags","content","name","path","sha");s.title=o.title=o.attributes.$$smap.doctitle,s.image=o.image=o.attributes.$$smap["hp-image"],s.tags=o.tags=extractTags(o.attributes),s.url=o.url=e.urls.getPostUrl(o.name);var i=Object.assign({},s,{original:o});return i.original.published_at=i.published_at=o.name.split("-").slice(0,3).join("-"),i});return t.nextState.posts=s,t}),t.on("requestRenderingPost",function(t){console.info("Asciidoc Plugin - requestRenderingPost"),console.log("requestRenderingPost",t);var e=convert(t.rootState.application.config,t.nextState.post.content);t.nextState.post=Object.assign({},t.nextState.post,e),t.nextState.post.title=e.attributes.$$smap.doctitle,t.nextState.post.image=e.attributes.$$smap["hp-image"],t.nextState.post.tags=extractTags(e.attributes),t.nextState.post.published_at=e.attributes.$$smap.published_at||t.nextState.post.published_at||(0,_moment2["default"])().format("YYYY-MM-DD");var s=e.attributes.$$smap["hp-alt-title"];return t.nextState.post.name=(0,_hubpressCoreSlugify2["default"])(t.nextState.post.published_at+"-"+(s||t.nextState.post.title))+".adoc",t.nextState.post.url=t.rootState.application.config.urls.getPostUrl(t.nextState.post.name),t})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.asciidocPlugin=asciidocPlugin;var _asciidoctor=require("asciidoctor.js"),_asciidoctor2=_interopRequireDefault(_asciidoctor),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),_hubpressCoreSlugify=require("hubpress-core-slugify"),_hubpressCoreSlugify2=_interopRequireDefault(_hubpressCoreSlugify),asciidoctor=(0,_asciidoctor2["default"])(!1,window.XMLHttpRequest),opal=asciidoctor.Opal,processor=asciidoctor.Asciidoctor(!0);