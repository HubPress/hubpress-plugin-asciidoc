"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function splitMore(t){var e=t.split("pass::[more]");return{excerpt:e[0],full:e.join("")}}function convert(t){var e=splitMore(t),a=processor.$load(e.excerpt,options),s=processor.$load(e.full,options),i={attributes:s.attributes,excerpt:a.$convert(),html:s.$convert()};return i}function asciidocPlugin(t){t.on("requestRenderingDocuments",function(t){var e=(t.data.documents.posts||[]).map(function(e){var a=Object.assign({},e,convert(e.content),{content:e.content}),s=_lodash2["default"].pick(a,"attributes","author","html","tags","content","name","path","sha");a.title=s.title=s.attributes.map.doctitle,a.image=s.image=s.attributes.map["hp-image"],a.tags=s.tags=s.attributes.map["hp-tags"]&&s.attributes.map["hp-tags"].split(","),a.url=s.url=t.data.config.urls.getPostUrl(s.name);var i=Object.assign({},a,{original:s});return i.original.published_at=i.published_at=s.name.split("-").slice(0,3).join("-"),i}),a=Object.assign({},t.data.documents,{posts:e}),s=Object.assign({},t.data,{documents:a});return Object.assign({},t,{data:s})}),t.on("requestRenderingPost",function(t){var e=convert(t.data.post.content);e._id=t.data.post._id,console.log("refreshedPost",e),e.title=e.attributes.map.doctitle,e.image=e.attributes.map["hp-image"],e.tags=e.attributes.map["hp-tags"]&&e.attributes.map["hp-tags"].split(","),e.published_at=e.attributes.map.published_at||e.published_at||(0,_moment2["default"])().format("YYYY-MM-DD");var a=e.attributes.map["hp-alt-title"];e.name=(0,_hubpressCoreSlugify2["default"])(e.published_at+"-"+(a||e.title))+".adoc",e.url=t.state.application.config.urls.getPostUrl(e.name);var s=Object.assign({},t.data.post,e),i=Object.assign({},t.data,{post:s});return Object.assign({},t,{data:i})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.asciidocPlugin=asciidocPlugin;var _asciidoctorJs=require("asciidoctor.js"),_asciidoctorJs2=_interopRequireDefault(_asciidoctorJs),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),_hubpressCoreSlugify=require("hubpress-core-slugify"),_hubpressCoreSlugify2=_interopRequireDefault(_hubpressCoreSlugify),asciidoctor=(0,_asciidoctorJs2["default"])(),opal=asciidoctor.Opal,processor=asciidoctor.Asciidoctor(!1),options=opal.hash2(["safe","attributes"],{safe:"unsafe",attributes:["showtitle!","imagesdir=/images","icons=font"]});