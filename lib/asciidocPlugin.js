"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function splitMore(t){var e=t.split("pass::[more]");return{excerpt:e[0],full:e.join("")}}function convert(t,e){var s=opal.hash({doctype:"article",backend:"html5",safe:"safe",attributes:["showtitle!","imagesdir="+t.data.config.urls.site+"/images","icons=font"]}),a=splitMore(e),i=processor.$load(a.excerpt,s),o=processor.$load(a.full,s),r={attributes:_lodash2["default"].pick(o.attributes,["smap"]),excerpt:i.$convert(),html:o.$convert()};return r}function extractTags(t){var e="hp-tags";return t.smap[e]&&t.smap[e].split(",")}function asciidocPlugin(t){t.on("requestRenderingDocuments",function(t){console.info("Asciidoc Plugin - requestRenderingDocuments"),console.log("requestRenderingDocuments",t);var e=(t.data.documents.posts||[]).map(function(e){var s=Object.assign({},e,convert(t,e.content),{content:e.content}),a=_lodash2["default"].pick(s,"attributes","author","html","tags","content","name","path","sha");s.title=a.title=a.attributes.smap.doctitle,s.image=a.image=a.attributes.smap["hp-image"],s.tags=a.tags=extractTags(a.attributes),s.url=a.url=t.data.config.urls.getPostUrl(a.name);var i=Object.assign({},s,{original:a});return i.original.published_at=i.published_at=a.name.split("-").slice(0,3).join("-"),i}),s=Object.assign({},t.data.documents,{posts:e}),a=Object.assign({},t.data,{documents:s});return Object.assign({},t,{data:a})}),t.on("requestRenderingPost",function(t){console.info("Asciidoc Plugin - requestRenderingPost"),console.log("requestRenderingPost",t);var e=convert(t,t.data.post.content);e._id=t.data.post._id,e.title=e.attributes.smap.doctitle,e.image=e.attributes.smap["hp-image"],e.tags=extractTags(e.attributes),e.published_at=e.attributes.smap.published_at||t.data.post.published_at||(0,_moment2["default"])().format("YYYY-MM-DD");var s=e.attributes.smap["hp-alt-title"];e.name=(0,_hubpressCoreSlugify2["default"])(e.published_at+"-"+(s||e.title))+".adoc",e.url=t.state.application.config.urls.getPostUrl(e.name);var a=Object.assign({},t.data.post,e),i=Object.assign({},t.data,{post:a});return Object.assign({},t,{data:i})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.asciidocPlugin=asciidocPlugin;var _asciidoctor=require("asciidoctor.js"),_asciidoctor2=_interopRequireDefault(_asciidoctor),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),_hubpressCoreSlugify=require("hubpress-core-slugify"),_hubpressCoreSlugify2=_interopRequireDefault(_hubpressCoreSlugify),asciidoctor=(0,_asciidoctor2["default"])(),opal=asciidoctor.Opal,processor=asciidoctor.Asciidoctor();